# DPCチェッカー ver 0.13

Dファイル・EFファイルをロードし、SQLiteデータベースに登録して
クエリを発行するアプリケーションです。
現在はデータ識別番号／入院年月日別の出来高対比、退院処方の入力ミスチェックなどの
機能を実装しています。Windowsアプリケーション版も用意してありますので、ご利用ください。
全くの未完成なので、バージョンは0.13としてあります。


## 使用方法

### 起動
Windowsの場合、[こちら](https://github.com/stagira13/dpc_checker/releases)に実行可能なアプリケーションを用意してあります。  
dpc_checker.zipをダウンロードし、任意の場所に展開してください（展開後は400MB超になります）。  
ビルドの関係上、大量のファイルが入っていますが、その中の`dpc_checker.exe`を起動します。するとまずコンソール画面が開き、続いてブラウザが起動してトップ画面が表示されます。
![top](https://cloud.githubusercontent.com/assets/20499723/23747405/e19e42a2-0502-11e7-81e2-5351e942c998.jpg)

### ファイル登録
  
EFファイル（ヘッダ付きのみ対応）、Dファイル（ヘッダなしのみ対応）を用意して、データの登録を行ってください。  

![submit](https://cloud.githubusercontent.com/assets/20499723/23747404/e1891fb2-0502-11e7-98be-5e4c274aea23.jpg)

このアプリケーションは、ローカルでサーバーを起動し、ウェブサイトとして表示するものです。ブラウザによっては「アップロード中」のような表示が出ますが、外部への接続などは一切行われません。  
データは`dpc_checker`フォルダ直下の`dpc.db`ファイルに保存されます。  
何か問題があれば、`dpc.db`ファイルを削除すると直るかも知れません。
（削除しても、登録データが消えるだけで、次回起動時に空のファイルが自動作成されます）  

### クエリ発行、ダッシュボード

![query](https://cloud.githubusercontent.com/assets/20499723/23747406/e1a1393a-0502-11e7-9273-0fc8a3c613c3.jpg)

クエリ発行ページからは、好きなクエリを選択して実行することが可能です。  
実行後、CSVダウンロードリンクをクリックすると、CSV形式のデータを取得出来ます。  
また、ダッシュボード画面では可視化されたデータを見ることが出来ます。

### 終了方法
ブラウザを閉じてもアプリケーションは終了しません。コンソール画面を×で閉じるか、コンソール上でCtrl + Cを押して終了させてください。

## 更新履歴

### ver 0.13での新機能　ダッシュボード機能にDPC入院料の金額／件数トップ10を追加
グラフだけでも見づらいので、DPC症例の金額／件数トップ10を表示するようにしました。  
ちなみに、DPC分類を使うと肺炎／脳梗塞がCCP Matrixの影響をモロに被ってしまい、細分化されてしまうため、MDC6を使っています。  
実装はズルをしていて、ここだけFlaskから直接レンダリングしてますが、いい方法があれば書き直すかも知れません。  
（pandasのto_htmlメソッドは１メソッドでテーブルを作れてしまいます。下手にajaxでJSONからテーブルを作成するより、よっぽど速いし簡単だったり･･･）
また、今回から実験的にWindowsアプリケーションも配布します。こちらはPythonの環境などがなくても、exeを叩けば実行できるので、気軽に使える･･･はず･･･
また、ライセンスを追加しました。普通にMITとなっております。

### vwe 0.12での新機能　ダッシュボード機能の書き直し／DPC入院料のグラフを追加
予告通りダッシュボード機能を書き換えました。ついでにDPC入院料のグラフを追加しています。  
今まではajaxも使わず、HTMLにJavaSciptが混在しており、HTMLの教科書の始めに書いてある「やってはいけないこと」を全部やったような代物でしたが、大分マシになった･･･筈･･･です。
コードの見通しがよくなって、拡張しやすくなったので、思いつくままグラフを追加するかも知れません。科名の日本語化は早いうちにやってしまおうと思います。


### ver 0.11での新機能　認知症ケア加算の算定チェック機能
SQLの追加をアップデートを呼ぶな！と言われたらそれまでですが、認知症ケア加算の算定チェックを行うクエリが追加されています。  
また、ダッシュボード機能の実装が**とてつもなく**酷いことは分かっていますので、近く書き換える予定です。


### ver 0.10での新機能　ダッシュボード機能

ver 0.10よりダッシュボード機能を追加しました。  
ひとまず、科別・病棟別の出来高対比グラフ・収益分布チャートが描画されます。  
現在は診療科区分がデータ名のままですが、いずれ日本語科名に対応する予定です。
なお、グラフ描画はC3.jsで行いました。


### ver 0.08 デザイン修正／挙動修正
GoogleのMaterial Design LiteのTemplateを流用して、ほんの少しだけデザインがマシになりました。まだ色々工事中です。    
それとは別に、登録・削除を行う度、別ページに遷移する変な挙動が修正されました。


### ver 0.07の新機能 外部クエリ読み込み

ver 0.07より外部クエリの読み込みに対応しました。
`query`フォルダ直下にテキストファイルでSQLクエリを保存してください（エンコーディングはUTF-8にする必要があります）。
DPCチェッカー起動時に自動的に読み込まれ、`クエリ発行ページ`のクエリリストに追加されます。


## 既知の問題点/未実装機能

<del>- 抽出データのcsvエクスポート機能　未実装（予定あり）</del> 0.06で実装済み
</br>
<del>- 外部クエリの読み込み機能　未実装（予定あり）　</del> 0.07で実装済み
</br>
<del>- グラフによるデータの可視化　未実装 </del> 0.10で実装開始
- 特定の病棟を除外する機能　未実装（予定あり）
- 複数月にまたがるデータの登録　未実装（方針未決定）
- 見た目をマトモにする。Material Design Liteに乗っかる。

## 使用ライブラリ

- Pandas
- Flask
- DataTables
- jquery
- Material Design Lite
- D3.js
- C3.js

## 動作条件（Pythonスクリプトでの実行。Windows版は特になし）

Python 3.x系統　Flask,Pandas必須
Anaconda推奨

